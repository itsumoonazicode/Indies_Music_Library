<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>music library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 0;
        }
        img.disabled {
            filter: blur(4px);
        }
        /* フッター部分 */
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #ccc;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>買ったCDをビジュアル的に管理したい</h1>
    <div>
        <input type="text" name="" id="artist_name">
        <input type="file" name="" id="image_file">
    </div>
    <hr>
    <div id="list"></div>
    <footer>
        <p>
            <button id="btn_to_show_img">post</button>
        </p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ImgFile = document.getElementById('image_file');
            const BtnShow = document.getElementById('btn_to_show_img');
            const artist_name = document.getElementById('artist_name');
            const list = document.getElementById('list');

            // 組み立てたノードを一時的にストックするための容器
            const frag = document.createDocumentFragment();

            BtnShow.addEventListener('click', (res) => {

                const p_tag = document.createElement('p');
                const text = document.createTextNode(artist_name.value);
                p_tag.appendChild(text);
                // つくったpタグやテキストをDocumentFramgmentオブジェクトに突っ込む
                frag.appendChild(p_tag);

                list.appendChild(frag);

                // FileReaderオブジェクトを使う
                const input = ImgFile.files[0];
                const reader = new FileReader();

                // console.table(reader);
                reader.addEventListener('load', (e) => {

                    // imgタグを作成する
                    const img_anchor = document.createElement('img');
                    // img_anchor.classList.add('highlight');
                    img_anchor.src = reader.result;
                    list.appendChild(img_anchor);

                    // クリックした画像にクラスをつけたり外したり
                    list.addEventListener('click', (e) => {
                        const img = e.target;
                        if(img.tagName === 'IMG') {
                            if(img.classList.contains('disabled')) {
                                img.classList.remove('disabled');
                            } else {
                                img.classList.add('disabled');
                            }
                        }
                    }, false);
                }, false);

                // エラーハンドリング
                reader.addEventListener('error', () => {
                    console.error(reader.error.message);
                }, true);
                reader.readAsDataURL(input);
                // 画像を表示させるごとにvalueを初期化する
                ImgFile.value = "";
            }, false);

        }, false);
        
    </script>
</body>
</html>